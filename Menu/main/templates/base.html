<!DOCTYPE html>
<html lang="en">
  {% load static %}

  <head>
    <!-- basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
    <!-- site metas -->
    <title>AMDIA üçî {% block title %} {% endblock title %}</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <!-- favicon -->
    <link rel="icon" href="{% static 'images/favicon.png' %}" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
      media="screen"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />

    <!-- cdnjs intl-tel link -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/25.2.0/build/css/intlTelInput.min.css"
      integrity="sha512-X3pJz9m4oT4uHCYS6UjxVdWk1yxSJJIJOJMIkf7TjPpb1BzugjiFyHu7WsXQvMMMZTnGUA9Q/GyxxCWNDZpdHA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- AOS CSS LINK -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

    <!-- custom css link -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/s.css' %}" />
    <link rel="stylesheet" href="{% static 'css/menu.css'%}" />

    <!-- Custom Messages Styling -->
    <style>
      .messages-container {
        animation: slideInRight 0.3s ease-out;
      }
      
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      .message-alert {
        border-left: 4px solid;
        font-weight: 500;
      }
      
      .alert-success {
        border-left-color: #28a745;
        background-color: #d4edda;
        color: #155724;
      }
      
      .alert-error {
        border-left-color: #dc3545;
        background-color: #f8d7da;
        color: #721c24;
      }
      
      .alert-warning {
        border-left-color: #ffc107;
        background-color: #fff3cd;
        color: #856404;
      }
      
      .alert-info {
        border-left-color: #17a2b8;
        background-color: #d1ecf1;
        color: #0c5460;
      }
      
      /* Cart shake animation */
      .cart-shake {
        animation: shake 0.6s ease-in-out;
      }
      
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }
      
      /* Cart pulse animation */
      .cart-pulse {
        animation: pulse 0.6s ease-in-out;
      }
      
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
      }
    </style>
  </head>

  <body>
    <!--header section start -->

    <nav
      class="navbar navbar-expand-lg new_navbar bg-transparent"
      data-bs-theme="dark"
    >
      <div class="container-fluid nav-container">
        <a class="navbar-brand brand-logo" href="{% url 'index' %}"
          ><b>AM</b>DIA</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == '/' %} active {% endif %}"
                href="{% url 'index' %}"
                >Home</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == '/about/' %} active {% endif %}"
                href="{% url 'about' %}"
                >About Us</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == '/menu/' %} active {% endif %}"
                href="{% url 'menu' %}"
                >Our Menu</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == '/services/' %} active {% endif %}"
                href="{% url 'services' %}"
                >Our Services</a
              >
            </li>
          </ul>
          <div class="d-flex gap-3 px-3 mx-auto">
            {% if request.user.is_authenticated %}
            <div class="user-greeting">
              <span>üëã </span> <h3 class="text-decoration-underline fs-6 welcome-text">Welcome, {{ request.user.username }}!</h3>
            </div>
            {% else %}
            <a href="{% url 'login' %}">
              <button class="btn custom-login-btn">Login</button>
            </a>
            <a href="{% url 'register' %}">
              <button class="btn custom-signup-btn">Sign Up</button>
            </a>
            {% endif %}
          </div>

          <div class="icon_ho">
            <a
              href="https://www.facebook.com/aaditya.thakuri.543/"
              target="_blank"
            >
              <i class="fa-brands fa-facebook"></i>
            </a>
            <a
              href="https://www.instagram.com/aditya_malla_thakuri_/"
              target="_blank"
            >
              <i class="fa-brands fa-instagram"></i>
            </a>
            {% if request.user.is_authenticated %}
            <!-- Cart Icon -->
            <div class="cart-container" style="position: relative; display: inline-block;">
              <a class="btn text-light" href="{% url 'cart' %}" id="cart-btn" style="position: relative;">
                <i class="fa-solid fa-cart-shopping"></i>
                <span id="cart-count" class="badge bg-danger" style="position: absolute; top: -5px; right: -5px; font-size: 0.7em; min-width: 18px; height: 18px; line-height: 18px; border-radius: 50%;">{{ cart_count|default:0 }}</span>
              </a>
            </div>
            
            <!-- Favorites Icon -->
            <div class="favorites-container" style="position: relative; display: inline-block; margin-left: 10px;">
              <a class="btn text-light" href="{% url 'favorites' %}" style="position: relative;">
                <i class="fa-solid fa-heart"></i>
                <span id="favorites-count" class="badge bg-danger" style="position: absolute; top: -5px; right: -5px; font-size: 0.7em; min-width: 18px; height: 18px; line-height: 18px; border-radius: 50%;">{{ favorites_count|default:0 }}</span>
              </a>
            </div>
            
            <!-- User Menu -->
            <div class="dropdown" style="display: inline-block; margin-left: 10px;">
              <a class="btn text-light dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-user"></i> {{ request.user.first_name|default:request.user.username }}
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{% url 'order_history' %}"><i class="fas fa-history"></i> Order History</a></li>
                <li><a class="dropdown-item" href="{% url 'favorites' %}"><i class="fas fa-heart"></i> Favorites</a></li>
                <li><a class="dropdown-item" href="{% url 'change_password' %}"><i class="fas fa-key"></i> Change Password</a></li>
                {% if request.user.is_staff %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'admin_dashboard' %}"><i class="fas fa-tachometer-alt"></i> Admin Dashboard</a></li>
                <li><a class="dropdown-item" href="{% url 'manage_orders' %}"><i class="fas fa-shopping-cart"></i> Manage Orders</a></li>
                {% endif %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'log_out' %}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
              </ul>
            </div>
            {% endif %}
          </div>
          

          <a href="{% url 'contact' %}"
            ><button class="custom-btn btn-1" style="margin-left: 10px;">Contact Us</button></a
          >

          <!-- <form class="d-flex" role="search">
               <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
               <button class="btn btn-outline-success" type="submit">Search</button>
             </form> -->
        </div>
      </div>
    </nav>

    <!-- Messages Section -->
    {% if messages %}
    <div class="messages-container" style="position: fixed; top: 80px; right: 20px; z-index: 9999; max-width: 400px;">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show message-alert" 
           style="margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 8px;">
        <strong>
          {% if message.tags == 'success' %}
            <i class="fas fa-check-circle"></i>
          {% elif message.tags == 'error' %}
            <i class="fas fa-exclamation-circle"></i>
          {% elif message.tags == 'warning' %}
            <i class="fas fa-exclamation-triangle"></i>
          {% else %}
            <i class="fas fa-info-circle"></i>
          {% endif %}
        </strong>
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% block content %} {% endblock content %}

    <!-- footer section start -->
    <div class="footer_section layout_padding">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-sm-6">
            <h3 class="useful_text">About</h3>
            <p class="footer_text">
              We at <b style="font: bold">AMDIA</b> believe that dining is more
              than just a meal ‚Äî it's an experience. From the moment you step
              through our doors, you're welcomed into an atmosphere of warmth,
              elegance, and exceptional hospitality.
            </p>
          </div>
          <div class="col-lg-3 col-sm-6">
            <h3 class="useful_text"><b style="color: #f76d37">AM</b>DIA</h3>
            <div class="footer_menu">
              <ul>
                <li><a href="{% url 'index' %}">Home</a></li>
                <li><a href="{% url 'about' %}">About Us</a></li>
                <li><a href="{% url 'menu' %}">Our Menu</a></li>
                <li><a href="{% url 'services' %}">Our Services</a></li>
                <li><a href="{% url 'contact' %}">Contact Us</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6">
            <h3 class="useful_text">Legals</h3>
            <div class="footer_menu">
              <ul>
                <li><a href="#">Terms and conditions</a></li>
                <li><a href="#">Privacy</a></li>
                <li><a href="#">Policy</a></li>
                <li><a href="#">Support</a></li>
              </ul>
            </div>
          </div>

          <div class="col-lg-3 col-sm-6">
            <h1 class="useful_text">Contact Us</h1>
            <div class="location_text">
              <ul>
                <li>
                  <a href="#">
                    <i class="fa fa-map-marker" aria-hidden="true"></i
                    ><span class="padding_left_10"
                      >Address: Changunararyn,Bhaktapur,Nepal
                    </span>
                  </a>
                </li>
                <li>
                  <a href="tel:9860687209" target="_blank">
                    <i class="fa fa-phone" aria-hidden="true"></i
                    ><span class="padding_left_10">Call: +9779860687209</span>
                  </a>
                </li>
                <li>
                  <a href="mailto:thakuriaditya121@gmail.com" target="_blank">
                    <i class="fa fa-envelope" aria-hidden="true"></i
                    ><span class="padding_left_10"
                      >Email: amdia1234@gmail.com</span
                    >
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- footer section end -->
    <!-- copyright section start -->
    <div class="copyright_section">
      <div class="container">
        <p class="copyright_text">
          {{data.year}}&copy;All Rights Reserved. Design by
          <a href="#">Freaks</a>
        </p>
      </div>
    </div>
    <!-- copyright section end -->
    <!-- Javascript files-->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!--cdn js intl-tel link  -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/25.2.0/build/js/intlTelInput.min.js"
      integrity="sha512-H0skyHW3SNpqlUsVKCM9+5ufNLLipKqvFeGapbvGlgv9RV6KulEDsRNZ7wMV7R0Hs8nMxalbJAF+d+NmNdYVYA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!-- custom js -->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/menu.js' %}"></script>

    <!-- jQuery for Bootstrap 5 compatibility -->
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <script
      src="https://kit.fontawesome.com/b52396679f.js"
      crossorigin="anonymous"
    ></script>

    <!-- AOS JS LINK -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
      AOS.init();
    </script>

    <!-- Real-time WebSocket notifications -->
    {% if request.user.is_authenticated %}
    <script>
        // WebSocket for real-time notifications
        let notificationSocket = null;
        
        function connectNotifications() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = protocol + '//' + window.location.host + '/ws/notifications/{{ request.user.id }}/';
            
            notificationSocket = new WebSocket(wsUrl);
            
            notificationSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                showNotification(data.title, data.message, data.notification_type);
            };
            
            notificationSocket.onclose = function(e) {
                console.log('Notification socket closed. Attempting to reconnect...');
                setTimeout(connectNotifications, 5000);
            };
            
            notificationSocket.onerror = function(e) {
                console.error('WebSocket error:', e);
            };
        }
        
        function showNotification(title, message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = `
                top: 20px; right: 20px; z-index: 9999; max-width: 350px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            notification.innerHTML = `
                <strong>${title}</strong><br>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Connect when page loads
        document.addEventListener('DOMContentLoaded', connectNotifications);
    </script>
    {% endif %}

    <!-- Auto-dismiss messages after 4 seconds -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-dismiss messages after 4 seconds
            const messageAlerts = document.querySelectorAll('.message-alert');
            messageAlerts.forEach(function(alert) {
                // Check if it's a success message about cart
                if (alert.classList.contains('alert-success') && 
                    alert.textContent.toLowerCase().includes('cart')) {
                    // Animate the cart icon
                    const cartIcon = document.getElementById('cart-btn');
                    if (cartIcon) {
                        cartIcon.classList.add('cart-pulse');
                        setTimeout(() => {
                            cartIcon.classList.remove('cart-pulse');
                        }, 600);
                    }
                }
                
                setTimeout(function() {
                    if (alert && alert.parentNode) {
                        // Use Bootstrap's dismiss method if available
                        if (typeof bootstrap !== 'undefined' && bootstrap.Alert) {
                            const bootstrapAlert = bootstrap.Alert.getInstance(alert);
                            if (bootstrapAlert) {
                                bootstrapAlert.close();
                            } else {
                                // Create new instance and close
                                new bootstrap.Alert(alert).close();
                            }
                        } else {
                            // Fallback: manual removal with fade effect
                            alert.style.transition = 'opacity 0.3s ease';
                            alert.style.opacity = '0';
                            setTimeout(() => {
                                if (alert.parentNode) {
                                    alert.remove();
                                }
                            }, 300);
                        }
                    }
                }, 4000); // 4 seconds
            });
        });
    </script>

  </body>
</html>
